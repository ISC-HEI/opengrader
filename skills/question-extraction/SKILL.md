---
name: question-extraction
description: Use this skill to extract questions from exam files (markdown, LaTeX, PDF) and create a structured questions.yaml file. Handles LaTeX conditionals (\ifsolution), separates questions from solutions, and preserves metadata.
---

# Question Extraction Skill

## Overview

This skill extracts exam questions from various source formats and creates a structured YAML file that can be used for grading. It handles complex formats like markdown with embedded LaTeX, including solution blocks.

## When to Use

- When the teacher has a question file that needs to be parsed
- After inventory shows a question file is available
- Before creating a rubric (rubric creation needs structured questions)
- When the teacher says "extract questions" or "parse the exam"

## Supported Formats

1. **Markdown with LaTeX** (*.md)
   - Handles LaTeX commands and environments
   - Parses `\ifsolution` ... `\fi` blocks to separate solutions
   - Preserves code blocks (SQL, Python, etc.)
   - Extracts YAML frontmatter metadata

2. **Plain Markdown** (*.md)
   - Standard markdown format
   - Code blocks and formatting preserved

3. **PDF** (*.pdf)
   - Use the pdf skill to extract text first
   - Then parse the extracted text

4. **LaTeX** (*.tex)
   - Pure LaTeX files
   - Handles solution environments

## Instructions

### Step 1: Identify the Question File

From the inventory or user input, identify which file contains the questions.

If multiple files exist, ask: "I found multiple question files: [list]. Which one should I extract?"

### Step 2: Read the File

Use the appropriate tool to read the file contents:
- For markdown/LaTeX: read the file directly
- For PDF: use the pdf skill to extract text first

### Step 3: Parse the Content

#### For Markdown with LaTeX (like sql.md):

1. **Extract YAML frontmatter** (between `---` markers at the start)
   - title, course, author, date, version, etc.

2. **Identify question sections**
   - Look for markdown headers (# Q1, ## Question 2, etc.)
   - Questions typically start with `#` or `##` followed by "Q", "Question", or a number

3. **Parse each question**:
   - **Question number/ID**: Extract from header (Q1, Q2, etc.)
   - **Question title**: Text after the question number (e.g., "Relations entre tables")
   - **Points**: Look for point values in brackets (e.g., "[3 pts]", "[6 points]")
   - **Question text**: Everything from the header until `\ifsolution` or next question
   - **Solution**: Content between `\ifsolution` and `\fi` (or `\else` if present)
   - **Question type**: Infer from content (multiple-choice, SQL query, modeling, etc.)

4. **Handle LaTeX conditionals**:
   ```latex
   \ifsolution
   **Solution:**
   [solution content]
   \else
   [student workspace - usually empty lines or \lignes{N}]
   \fi
   ```
   - Extract solution from `\ifsolution` block
   - Ignore `\else` block (it's for student version)

5. **Preserve formatting**:
   - Keep code blocks intact (```sql, ```python, etc.)
   - Preserve multi-line content
   - Keep special characters and formatting

#### For Plain Markdown:

- Similar to above but without LaTeX conditional handling
- Solutions might be in separate sections or marked differently

### Step 4: Create questions.yaml

Structure the output as YAML with this format:

```yaml
# Extracted questions from [source_file]
# Generated by OpenGrader on [date]

metadata:
  title: "RDB, 1er Contrôle Continu, 2025"
  course: "Bases de données relationnelles (RBD)"
  author: "Renaud Richardet"
  date: "22.10.2025"
  version: "1.0.14"
  source_file: "sql.md"

questions:
  - id: "Q1"
    title: "Relations entre tables"
    points: 3
    bonus_points: 0.5
    type: "multiple_choice"  # or: sql_query, modeling, short_answer, essay
    given: |
      Soit les deux tables suivantes définies dans une RDB...
      
      ```sql
      CREATE TABLE Artist (
          ArtistId INTEGER PRIMARY KEY,
          Name NVARCHAR(120)
      );
      ```
      
      Parmi les affirmations suivantes, indiquez "V" pour vrai et "F" pour faux...
    
    solution: |
      1. vrai, la table Artist n'a aucune dépendance vers Album
      2. faux car la FK ArtistId empêche cela
      3. faux car la colonne ArtistId est defini comme NOT NULL dans Album
      ...
    
    notes: |
      Chaque bonne réponse rapporte 1/4 pt, chaque mauvaise réponse retire 1/10 pt.

  - id: "Q2"
    title: "Modélisation d'un système de gestion hospitalière"
    points: 6
    type: "modeling"
    given: |
      Vous êtes chargé.e de modéliser une RDB pour gérer les rendez-vous...
      
      ## Tâche 1 : Modélisation des différents types de rendez-vous [4 pts]
      ...
      
      ## Tâche 2 : Requête SQL [2 pts]
      ...
    
    solution: |
      ```sql
      CREATE TABLE type_rendez_vous (
          id_type_rendez_vous INT PRIMARY KEY,
          nom VARCHAR(100) NOT NULL
      );
      ```
      ...
    
    subtasks:
      - id: "Q2.1"
        title: "Modélisation"
        points: 4
      - id: "Q2.2"
        title: "Requête SQL"
        points: 2
```

### Step 5: Save the File

1. Create `opengrader/` directory if it doesn't exist
2. Save as `opengrader/questions.yaml`
3. Use the write_file tool (which will trigger human-in-the-loop confirmation)

### Step 6: Report Results

Provide a summary:

```
✓ Successfully extracted questions from [source_file]

## Summary
- Total questions: 4
- Total points: 15 (including 0.5 bonus)
- Question types: 2 multiple-choice, 1 modeling, 1 SQL query

## Output
Saved to: opengrader/questions.yaml

## Next Steps
You can now:
1. Review the extracted questions (open opengrader/questions.yaml)
2. Create a grading rubric based on these questions
3. Proceed to grading if you have a rubric
```

## Parsing Tips

### Identifying Question Boundaries

Look for patterns like:
- `# Q1`, `# Question 1`, `## Q1:`, `# 1.`
- Headers with point values: `# Q1 [3 pts]`
- Numbered sections at the same header level

### Extracting Points

Common patterns:
- `[3 pts]`, `[3 points]`, `(3 points)`
- `[3 pts + 0.5 pt bonus]`
- `[4 pts]` in subtask headers

### Handling Code Blocks

Preserve code blocks exactly as they appear:
```yaml
given: |
  Here's the SQL:
  
  ```sql
  SELECT * FROM table;
  ```
```

### Multi-line Content

Use YAML's `|` (literal) or `>` (folded) for multi-line strings:
- `|` preserves line breaks (use for code, formatted text)
- `>` folds lines into paragraphs (use for prose)

## Example Interaction

**Teacher**: "Extract the questions from sql.md"

**Agent** (using this skill):
```
Reading sql.md...

Found 4 questions:
- Q1: Relations entre tables (3 pts + 0.5 bonus)
- Q2: Modélisation d'un système de gestion hospitalière (6 pts)
- Q3: Albums Pop (computer question)
- Q4: Titres doublons (computer question)

Extracting metadata and solutions...

Creating opengrader/questions.yaml...
[Human confirmation prompt appears]

✓ Successfully extracted 4 questions with solutions
✓ Saved to: opengrader/questions.yaml

Would you like me to:
1. Show you a preview of the extracted questions
2. Create a grading rubric based on these questions
3. Something else
```

## Important Notes

- Always preserve the original formatting and content
- Don't interpret or modify the questions/solutions
- If parsing is ambiguous, ask the teacher for clarification
- Handle edge cases gracefully (missing points, unclear boundaries)
- Keep code blocks and special characters intact
- Use YAML comments to document any parsing decisions or warnings
